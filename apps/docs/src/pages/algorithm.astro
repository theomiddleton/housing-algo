---
import Layout from '../layouts/Layout.astro';
import { AlgorithmStepper } from '../components/AlgorithmStepper';
import { HungarianViz } from '../components/HungarianViz';
import { AlgorithmTabs } from '../components/AlgorithmTabs';
import { ChatGPTReviewButton } from '../components/ChatGPTReviewButton';
import { GeminiReviewButton } from '../components/GeminiReviewButton';
import { ReviewMyselfButton } from '../components/ReviewMyselfButton';
import { Card, CardHeader, CardTitle, CardDescription, CardContent } from '../components/ui/card';
import { Badge } from '../components/ui/badge';
---

<Layout title="Algorithm" description="Deep dive into the Hungarian Algorithm for optimal room assignment">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <!-- Header -->
    <div class="max-w-3xl mb-16">
      <Badge variant="outline" className="mb-4">Core Algorithm</Badge>
      <h1 class="text-4xl font-bold text-gray-100 mb-4">
        The Hungarian Algorithm
      </h1>
      <p class="text-xl text-muted-foreground mb-6">
        A polynomial-time algorithm for finding the optimal assignment in a weighted 
        bipartite graph. Perfect for matching people to rooms while maximizing total satisfaction.
      </p>
      <div class="flex items-center gap-3 text-sm text-muted-foreground flex-wrap">
        <span>Concerned about fairness?</span>
        <ChatGPTReviewButton client:load variant="ghost" size="sm" showDescription={false} />
        <GeminiReviewButton client:load variant="ghost" size="sm" showDescription={false} />
        <ReviewMyselfButton client:load variant="ghost" size="sm" />
      </div>
    </div>

    <!-- Interactive Stepper -->
    <section class="mb-20">
      <h2 class="text-2xl font-bold text-gray-100 mb-8">Algorithm Steps</h2>
      <AlgorithmStepper client:load />
    </section>

    <!-- Algorithm Visualization -->
    <section class="mb-20">
      <div class="flex items-center justify-between mb-8">
        <h2 class="text-2xl font-bold text-gray-100">Hungarian Algorithm Visualization</h2>
        <Badge>Interactive</Badge>
      </div>
      <Card>
        <CardContent className="pt-6">
          <HungarianViz client:load />
        </CardContent>
      </Card>
    </section>

    <!-- Deep Dive Sections -->
    <section class="mb-20">
      <h2 class="text-2xl font-bold text-gray-100 mb-8">Deep Dive</h2>
      <AlgorithmTabs client:only="react" />
    </section>

    <!-- Code Reference -->
    <section class="mb-20">
      <h2 class="text-2xl font-bold text-gray-100 mb-8">Implementation Reference</h2>
      <div class="grid md:grid-cols-2 gap-6">
        <Card>
          <CardHeader>
            <CardTitle className="text-lg">lib/scoring.ts</CardTitle>
            <CardDescription>Score calculation and normalization</CardDescription>
          </CardHeader>
          <CardContent>
            <ul class="space-y-2 text-sm text-muted-foreground">
              <li><code class="text-warning">buildRoomMetrics()</code> - Normalize room attributes</li>
              <li><code class="text-warning">buildPeopleMeta()</code> - Calculate priorities</li>
              <li><code class="text-warning">scoreRoom()</code> - Calculate person-room score</li>
              <li><code class="text-warning">buildDeterministicScores()</code> - Build full matrix</li>
            </ul>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle className="text-lg">lib/assignment.ts</CardTitle>
            <CardDescription>Hungarian algorithm implementation</CardDescription>
          </CardHeader>
          <CardContent>
            <ul class="space-y-2 text-sm text-muted-foreground">
              <li><code class="text-warning">hungarian()</code> - Core algorithm</li>
              <li><code class="text-warning">assignRooms()</code> - High-level API</li>
              <li><code class="text-warning">solveAssignment()</code> - ID-based result</li>
              <li><code class="text-warning">fnv1a()</code> - Hash for tie-breaking</li>
            </ul>
          </CardContent>
        </Card>
      </div>
    </section>

    <!-- Fairness Review CTA -->
    <section class="border-t border-blueprint-grid pt-16">
      <Card className="bg-gradient-to-br from-industrial-bg to-industrial-panel border-warning/20">
        <CardContent className="py-8">
          <div class="text-center">
            <h3 class="text-xl font-semibold text-gray-100 mb-2">
              Want to verify this algorithm is fair?
            </h3>
            <p class="text-muted-foreground mb-6 max-w-lg mx-auto">
              Transparency matters. Get an independent AI review of our scoring and assignment code to check for potential bias.
            </p>
            <div class="flex items-center justify-center gap-4 flex-wrap">
              <ChatGPTReviewButton client:load variant="default" size="lg" showDescription={false} />
              <GeminiReviewButton client:load variant="outline" size="lg" showDescription={false} />
              <ReviewMyselfButton client:load variant="outline" size="lg" />
            </div>
          </div>
        </CardContent>
      </Card>
    </section>
  </div>
</Layout>
